#!/usr/bin/env python3
"""Mock sacct command for testing."""

import argparse

# Tuple format: (JobID, Name, State, Restarts, Elapsed, ExitCode, NodeList, Submit, Start, End)
MOCK_HISTORY = [
    (
        "12345",
        "train_model",
        "RUNNING",
        "0",
        "2:34:56",
        "0:0",
        "gpu-node-[01-04]",
        "2024-01-15T10:30:00",
        "2024-01-15T10:35:00",
        "Unknown",
    ),
    (
        "12344",
        "train_model",
        "COMPLETED",
        "2",
        "4:00:00",
        "0:0",
        "gpu-node-[01-04]",
        "2024-01-15T06:00:00",
        "2024-01-15T06:05:00",
        "2024-01-15T10:05:00",
    ),
    (
        "12343",
        "preprocess",
        "COMPLETED",
        "0",
        "0:30:00",
        "0:0",
        "cpu-node-05",
        "2024-01-15T05:00:00",
        "2024-01-15T05:02:00",
        "2024-01-15T05:32:00",
    ),
    (
        "12342",
        "failed_job",
        "FAILED",
        "3",
        "0:05:23",
        "1:0",
        "gpu-node-02",
        "2024-01-15T04:00:00",
        "2024-01-15T04:01:00",
        "2024-01-15T04:06:23",
    ),
    (
        "12341",
        "timeout_job",
        "TIMEOUT",
        "0",
        "24:00:00",
        "0:0",
        "cpu-node-[01-08]",
        "2024-01-14T08:00:00",
        "2024-01-14T08:05:00",
        "2024-01-15T08:05:00",
    ),
    (
        "12340",
        "cancelled",
        "CANCELLED",
        "0",
        "0:10:00",
        "0:0",
        "gpu-node-01",
        "2024-01-14T12:00:00",
        "2024-01-14T12:01:00",
        "2024-01-14T12:11:00",
    ),
    (
        "12339",
        "inference",
        "COMPLETED",
        "1",
        "1:45:00",
        "0:0",
        "gpu-node-03",
        "2024-01-14T14:00:00",
        "2024-01-14T14:05:00",
        "2024-01-14T15:50:00",
    ),
    (
        "12338",
        "data_prep",
        "COMPLETED",
        "0",
        "0:20:00",
        "0:0",
        "cpu-node-10",
        "2024-01-14T10:00:00",
        "2024-01-14T10:01:00",
        "2024-01-14T10:21:00",
    ),
    (
        "12337",
        "node_fail",
        "NODE_FAIL",
        "0",
        "0:15:00",
        "0:0",
        "gpu-node-07",
        "2024-01-14T09:00:00",
        "2024-01-14T09:02:00",
        "2024-01-14T09:17:00",
    ),
    (
        "12336",
        "long_train",
        "COMPLETED",
        "5",
        "48:00:00",
        "0:0",
        "gpu-node-[01-08]",
        "2024-01-12T08:00:00",
        "2024-01-12T08:30:00",
        "2024-01-14T08:30:00",
    ),
]

# Mock energy history data for --allusers queries
# Format: (JobID, User, Elapsed, NCPUS, AllocTRES, State)
MOCK_ENERGY_DATA = [
    ("50001", "user1", "12:30:00", "64", "cpu=64,mem=512G,gres/gpu=32", "COMPLETED"),
    ("50002", "user1", "8:15:00", "64", "cpu=64,mem=512G,gres/gpu=32", "COMPLETED"),
    ("50003", "user2", "24:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50004", "user2", "6:45:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50005", "user3", "48:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50006", "user3", "36:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50007", "user3", "12:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50008", "user4", "72:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50009", "user4", "24:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50010", "user5", "168:00:00", "768", "cpu=768,mem=8000G,gres/gpu=32", "COMPLETED"),
    ("50011", "user5", "96:00:00", "768", "cpu=768,mem=8000G,gres/gpu=32", "COMPLETED"),
    ("50012", "user6", "4:30:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50013", "user7", "18:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50014", "user7", "12:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50015", "user7", "6:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50016", "user8", "10:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
    ("50017", "user8", "8:00:00", "192", "cpu=192,mem=2000G,gres/gpu=8", "COMPLETED"),
]

# Mock wait time data for --allusers queries
# Format: (JobID, Partition, State, Submit, Start)
MOCK_WAIT_TIME_DATA = [
    ("12345", "gpu-a100", "RUNNING", "2024-01-15T10:00:00", "2024-01-15T10:05:00"),
    ("12346", "gpu-a100", "COMPLETED", "2024-01-15T10:10:00", "2024-01-15T10:15:00"),
    ("12347", "gpu-a100", "COMPLETED", "2024-01-15T10:20:00", "2024-01-15T10:30:00"),
    ("12348", "cpu", "COMPLETED", "2024-01-15T10:00:00", "2024-01-15T10:01:00"),
    ("12349", "cpu", "COMPLETED", "2024-01-15T10:05:00", "2024-01-15T10:06:00"),
    ("12350", "gpu-h200", "RUNNING", "2024-01-15T10:00:00", "2024-01-15T10:30:00"),
    ("12351", "gpu-h200", "COMPLETED", "2024-01-15T09:00:00", "2024-01-15T09:45:00"),
    ("12352", "gpu-a100", "PENDING", "2024-01-15T10:50:00", "Unknown"),
]


def output_energy_format(noheader: bool) -> None:
    """Output energy format data (JobID,User,Elapsed,NCPUS,AllocTRES,State)."""
    if not noheader:
        print("JobID|User|Elapsed|NCPUS|AllocTRES|State")
    for job in MOCK_ENERGY_DATA:
        print("|".join(job))


def output_wait_time_format(noheader: bool) -> None:
    """Output wait time format data (JobID,Partition,State,Submit,Start)."""
    if not noheader:
        print("JobID|Partition|State|Submit|Start")
    for job in MOCK_WAIT_TIME_DATA:
        print("|".join(job))


def output_standard_format(noheader: bool) -> None:
    """Output standard history format."""
    if not noheader:
        print("JobID|JobName|State|Restart|Elapsed|ExitCode|NodeList|Submit|Start|End")
    for job in MOCK_HISTORY:
        print("|".join(job))


def main() -> None:
    """Main entry point for mock sacct command."""
    parser = argparse.ArgumentParser()
    parser.add_argument("-u", "--user", default=None)
    parser.add_argument("--allusers", action="store_true")
    parser.add_argument("--format", default=None)
    parser.add_argument("-S", "--starttime", default=None)
    parser.add_argument("-X", action="store_true")
    parser.add_argument("-P", action="store_true")
    parser.add_argument("--noheader", action="store_true")
    parser.add_argument("-j", "--jobs", default=None)
    args = parser.parse_args()

    # Route to the appropriate output based on query format
    format_str = args.format or ""
    is_wait_time_query = args.allusers and "Submit" in format_str and "Start" in format_str
    is_energy_query = args.allusers and "AllocTRES" in format_str and "User" in format_str

    if is_wait_time_query:
        output_wait_time_format(args.noheader)
    elif is_energy_query:
        output_energy_format(args.noheader)
    else:
        output_standard_format(args.noheader)


if __name__ == "__main__":
    main()
