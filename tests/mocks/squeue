#!/usr/bin/env python3
"""Mock squeue command for testing."""

import argparse
import random

# Real job data from current cluster (with user field)
MOCK_JOBS_ALL_USERS = [
    ("47441", "rope_pct_llama_", "afkhan", "PENDING", "0:00", "8", "(Priority)"),
    ("47434", "rope_pct_llama_", "afkhan", "PENDING", "0:00", "8", "(Resources)"),
    ("47587", "sam3_multigpu", "flkar", "RUNNING", "5:29:36", "1", "daisg106"),
    ("47474_5", "sdvae_sit_b_2_r", "xichen", "RUNNING", "18:29", "1", "daisg114"),
    ("47475_2", "sdvae_sit_b_2_r", "xichen", "RUNNING", "32:59", "1", "daisg104"),
    ("47429", "train", "rmaser", "RUNNING", "12:30:07", "1", "daisg116"),
    ("46043", "foldmae", "dchen", "RUNNING", "12:58:54", "4", "daisg[111-113,115]"),
    ("47537", "foldmae", "dchen", "PENDING", "0:00", "4", "(Priority)"),
    ("47670", "17_imagenet128_", "bpogodzi", "PENDING", "0:00", "1", "(Nodes requi"),
    ("47671", "17_imagenet128_", "bpogodzi", "PENDING", "0:00", "1", "(Priority)"),
    ("47462_11", "decomposed_rep_", "jvanders", "RUNNING", "4:28", "1", "daisg103"),
    ("47458_11", "decomposed_rep_", "jvanders", "RUNNING", "8:59", "1", "daisg102"),
    ("47461_11", "lora_rep_rope_f", "jvanders", "RUNNING", "8:59", "1", "daisg103"),
    ("47457_11", "lora_rep_rope_r", "jvanders", "RUNNING", "12:29", "1", "daisg101"),
    ("47466_2", "train", "rmaser", "RUNNING", "10:10:41", "1", "daisg108"),
    ("47466_3", "train", "rmaser", "RUNNING", "10:10:41", "1", "daisg109"),
    ("47466_4", "train", "rmaser", "RUNNING", "10:10:41", "1", "daisg110"),
    ("47649_8", "pat_commonsense", "adhikar", "RUNNING", "2:18:57", "1", "daisg105"),
    ("47649_6", "pat_commonsense", "adhikar", "RUNNING", "2:28:06", "1", "daisg107"),
    ("47649_0", "pat_commonsense", "adhikar", "RUNNING", "2:28:32", "1", "daisg110"),
]

# Jobs without user field (for -u flag)
MOCK_JOBS_USER_ONLY = [
    ("12345", "train_model", "RUNNING", "2:34:56", "4", "gpu-node-[01-04]"),
    ("12346", "preprocess", "RUNNING", "0:45:12", "1", "cpu-node-05"),
    ("12347", "evaluate", "PENDING", "0:00", "2", "(Priority)"),
    ("12348", "inference", "PENDING", "0:00", "1", "(Resources)"),
    ("12349", "data_load", "RUNNING", "1:23:45", "1", "gpu-node-08"),
]


def main() -> None:
    parser = argparse.ArgumentParser()
    parser.add_argument("-u", "--user", default=None)
    parser.add_argument("-o", "--format", default=None)
    parser.add_argument("-a", "--all", action="store_true")
    args = parser.parse_args()

    # Determine format - check if user field is in format string
    has_user_field = args.format and "%.8u" in args.format
    is_all_users = args.all or (not args.user and has_user_field)

    if is_all_users and has_user_field:
        # All users format with user field
        print("     JOBID|           NAME|    USER|   STATE|      TIME|NODE|NODELIST(REASON)")
        jobs = MOCK_JOBS_ALL_USERS
    else:
        # User-specific format without user field
        print("     JOBID|        JOBNAME|   STATE|      TIME|   NODES|      NODELIST")
        jobs = MOCK_JOBS_USER_ONLY

    # Filter by user if specified
    if args.user and has_user_field:
        jobs = [job for job in jobs if len(job) > 2 and job[2] == args.user]
    elif args.user and not has_user_field:
        # For user-specific format, just return some jobs
        jobs = MOCK_JOBS_USER_ONLY

    # Randomly select some jobs to simulate dynamic queue
    num_jobs = random.randint(2, min(len(jobs), 10))
    selected_jobs = random.sample(jobs, num_jobs)

    for job in selected_jobs:
        if has_user_field and len(job) >= 7:
            job_id, name, user, state, time, nodes, nodelist = job[:7]
            print(f"{job_id:>10}|{name:>15}|{user:>8}|{state:>8}|{time:>10}|{nodes:>4}|{nodelist:>12}")
        elif len(job) >= 6:
            job_id, name, state, time, nodes, nodelist = job[:6]
            print(f"{job_id:>10}|{name:>15}|{state:>8}|{time:>10}|{nodes:>7}|{nodelist:>14}")


if __name__ == "__main__":
    main()
